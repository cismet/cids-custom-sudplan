/***************************************************
*
* cismet GmbH, Saarbruecken, Germany
*
*              ... and it just works.
*
****************************************************/
package de.cismet.cids.custom.sudplan.rainfall;

import Sirius.navigator.connection.SessionManager;
import Sirius.navigator.ui.ComponentRegistry;

import Sirius.server.middleware.types.MetaClass;

import org.apache.log4j.Logger;

import org.openide.util.NbBundle;
import org.openide.util.WeakListeners;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import java.net.MalformedURLException;

import de.cismet.cids.custom.sudplan.SMSUtils;
import de.cismet.cids.custom.sudplan.TimeseriesChartPanel;

import de.cismet.cids.dynamics.CidsBean;

import de.cismet.cids.navigator.utils.ClassCacheMultiple;

/**
 * DOCUMENT ME!
 *
 * @author   mscholl
 * @version  $Revision$, $Date$
 */
public class RainfallDownscalingOutputManagerUI extends javax.swing.JPanel {

    //~ Static fields/initializers ---------------------------------------------

    private static final transient Logger LOG = Logger.getLogger(RainfallDownscalingOutputManagerUI.class);

    //~ Instance fields --------------------------------------------------------

    private final transient RainfallDownscalingOutput model;

    private final transient ActionListener runL;
    private final transient ActionListener inputL;

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private final transient org.jdesktop.swingx.JXHyperlink hypInput = new org.jdesktop.swingx.JXHyperlink();
    private final transient org.jdesktop.swingx.JXHyperlink hypRun = new org.jdesktop.swingx.JXHyperlink();
    private final transient javax.swing.JTabbedPane jtpResults = new javax.swing.JTabbedPane();
    private final transient javax.swing.JLabel lblInput = new javax.swing.JLabel();
    private final transient javax.swing.JLabel lblRun = new javax.swing.JLabel();
    // End of variables declaration//GEN-END:variables

    //~ Constructors -----------------------------------------------------------

    /**
     * Creates new form RainfallDownscalingOutputManagerUI.
     *
     * @param  model  DOCUMENT ME!
     */
    public RainfallDownscalingOutputManagerUI(final RainfallDownscalingOutput model) {
        this.model = model;
        this.runL = new OpenRunActionListener();
        this.inputL = new OpenInputActionListener();

        initComponents();

        init();

        hypRun.addActionListener(WeakListeners.create(ActionListener.class, runL, hypRun));
        hypInput.addActionListener(WeakListeners.create(ActionListener.class, inputL, hypInput));
    }

    //~ Methods ----------------------------------------------------------------

    /**
     * DOCUMENT ME!
     *
     * @throws  IllegalStateException  DOCUMENT ME!
     */
    private void init() {
        final CidsBean resultTs = model.fetchTsResult();
        final CidsBean result30Ts = model.fetchTsResult30();
        final CidsBean input30Ts = model.fetchTsInput30();

        final TimeseriesChartPanel resultTsPanel;
        final TimeseriesChartPanel result30TsPanel;
        final TimeseriesChartPanel input30TsPanel;
        try {
            resultTsPanel = new TimeseriesChartPanel((String)resultTs.getProperty("uri"));     // NOI18N
            result30TsPanel = new TimeseriesChartPanel((String)result30Ts.getProperty("uri")); // NOI18N
            input30TsPanel = new TimeseriesChartPanel((String)input30Ts.getProperty("uri"));   // NOI18N
        } catch (final MalformedURLException ex) {
            final String message = "illegal ts uri";                                           // NOI18N
            LOG.error(message, ex);
            throw new IllegalStateException(message, ex);
        }

        jtpResults.addTab(model.getTsResultName(), resultTsPanel);
        jtpResults.addTab(model.getTsResult30Name(), result30TsPanel);
        jtpResults.addTab(model.getTsInput30Name(), input30TsPanel);

        final CidsBean runBean = SMSUtils.fetchCidsBean(model.getModelRunId(), SMSUtils.TABLENAME_MODELRUN);
        final CidsBean inputBean = SMSUtils.fetchCidsBean(model.getModelInputId(), SMSUtils.TABLENAME_MODELINPUT);

        hypRun.setText((String)runBean.getProperty("name"));
        hypInput.setText((String)inputBean.getProperty("name"));
    }

    /**
     * This method is called from within the constructor to initialize the form. WARNING: Do NOT modify this code. The
     * content of this method is always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        setOpaque(false);
        setLayout(new java.awt.GridBagLayout());

        jtpResults.setPreferredSize(new java.awt.Dimension(400, 300));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(7, 7, 7, 7);
        add(jtpResults, gridBagConstraints);

        lblRun.setText(NbBundle.getMessage(
                RainfallDownscalingOutputManagerUI.class,
                "RainfallDownscalingOutputManagerUI.lblRun.text")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(7, 7, 7, 7);
        add(lblRun, gridBagConstraints);

        hypRun.setText(NbBundle.getMessage(
                RainfallDownscalingOutputManagerUI.class,
                "RainfallDownscalingOutputManagerUI.hypRun.text")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(7, 7, 7, 7);
        add(hypRun, gridBagConstraints);

        lblInput.setText(NbBundle.getMessage(
                RainfallDownscalingOutputManagerUI.class,
                "RainfallDownscalingOutputManagerUI.lblInput.text")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(7, 7, 7, 7);
        add(lblInput, gridBagConstraints);

        hypInput.setText(NbBundle.getMessage(
                RainfallDownscalingOutputManagerUI.class,
                "RainfallDownscalingOutputManagerUI.hypInput.text")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(7, 7, 7, 7);
        add(hypInput, gridBagConstraints);
    }                                                                 // </editor-fold>//GEN-END:initComponents

    //~ Inner Classes ----------------------------------------------------------

    /**
     * DOCUMENT ME!
     *
     * @version  $Revision$, $Date$
     */
    private final class OpenRunActionListener implements ActionListener {

        //~ Methods ------------------------------------------------------------

        @Override
        public void actionPerformed(final ActionEvent e) {
            final MetaClass metaclass = ClassCacheMultiple.getMetaClass(
                    SessionManager.getSession().getUser().getDomain(),
                    SMSUtils.TABLENAME_MODELRUN);

            assert metaclass != null : "Run metaclass not present"; // NOI18N

            ComponentRegistry.getRegistry().getDescriptionPane().gotoMetaObject(metaclass, model.getModelRunId(), ""); // NOI18N
        }
    }

    /**
     * DOCUMENT ME!
     *
     * @version  $Revision$, $Date$
     */
    private final class OpenInputActionListener implements ActionListener {

        //~ Methods ------------------------------------------------------------

        @Override
        public void actionPerformed(final ActionEvent e) {
            final MetaClass metaclass = ClassCacheMultiple.getMetaClass(
                    SessionManager.getSession().getUser().getDomain(),
                    SMSUtils.TABLENAME_MODELINPUT);

            assert metaclass != null : "ModelInput metaclass not present"; // NOI18N

            ComponentRegistry.getRegistry().getDescriptionPane().gotoMetaObject(metaclass, model.getModelInputId(), ""); // NOI18N
        }
    }
}
