/***************************************************
*
* cismet GmbH, Saarbruecken, Germany
*
*              ... and it just works.
*
****************************************************/
package de.cismet.cids.custom.treeicons.sudplan;

import com.vividsolutions.jts.geom.Envelope;
import com.vividsolutions.jts.geom.Geometry;
import com.vividsolutions.jts.geom.MultiPolygon;
import com.vividsolutions.jts.io.WKTReader;

import org.geotools.geometry.jts.Geometries;
import org.geotools.geometry.jts.LiteShape;

import java.awt.BasicStroke;
import java.awt.Color;
import java.awt.GradientPaint;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Paint;
import java.awt.Rectangle;
import java.awt.geom.AffineTransform;

import java.util.ArrayList;
import java.util.List;

import javax.swing.JFrame;
import javax.swing.JPanel;

/**
 * DOCUMENT ME!
 *
 * @version  $Revision$, $Date$
 */
public class JTSDrawingPanel extends JPanel {

    //~ Static fields/initializers ---------------------------------------------

    private static final int MARGIN = 5;

    //~ Instance fields --------------------------------------------------------

    private List<Geometry> geometries = new ArrayList<Geometry>();
    private AffineTransform geomToScreen;

    //~ Methods ----------------------------------------------------------------

    /**
     * DOCUMENT ME!
     *
     * @param  geom  DOCUMENT ME!
     */
    public void addGeometry(final Geometry geom) {
        geometries.add(geom);
    }

    @Override
    protected void paintComponent(final Graphics g) {
        super.paintComponent(g);

        if (!geometries.isEmpty()) {
            setTransform();

            final Graphics2D g2d = (Graphics2D)g;
            final Paint polyPaint = new GradientPaint(0, 0, Color.CYAN, 100,
                    100, Color.MAGENTA, true);
            final Paint defaultPaint = Color.getHSBColor(223f / 360f, 0.45f, 0.76f);

            for (final Geometry geom : geometries) {
                final LiteShape shape = new LiteShape(geom, geomToScreen, false);
//                final Rectangle shape = new Rectangle(10,10,100, 100);

//                final BasicStroke bs = new BasicStroke(2f);

                g2d.setPaint(defaultPaint);
                g2d.fill(shape);
                g2d.setPaint(Color.BLACK);
//                g2d.setStroke(bs);
//                g2d.draw(shape);

//                g2d.setPaint(defaultPaint);
//                g2d.draw(shape);
            }
        }
    }

    /**
     * DOCUMENT ME!
     */
    private void setTransform() {
        final Envelope env = getGeometryBounds();
        final Rectangle drawingRect = new Rectangle(0, 0, 16, 16);

        final double scale = Math.min(drawingRect.getWidth()
                        / env.getWidth(),
                drawingRect.getHeight()
                        / env.getHeight());
        final double xoff = MARGIN - (scale * env.getMinX());
        final double yoff = MARGIN + (env.getMaxY() * scale);
        geomToScreen = new AffineTransform(scale, 0, 0, -scale, xoff, yoff);
    }

    /**
     * DOCUMENT ME!
     *
     * @return  DOCUMENT ME!
     */
    private Envelope getGeometryBounds() {
        final Envelope env = new Envelope();
        for (final Geometry geom : geometries) {
            final Envelope geomEnv = geom.getEnvelopeInternal();
            env.expandToInclude(geomEnv);
        }

        return env;
    }

    /**
     * DOCUMENT ME!
     *
     * @param   args  DOCUMENT ME!
     *
     * @throws  Exception  DOCUMENT ME!
     */
    public static void main(final String[] args) throws Exception {
        final JTSDrawingPanel panel = new JTSDrawingPanel();
        final JFrame frame = new JFrame("Draw geometries");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.add(panel);
        frame.setSize(500, 500);

        final WKTReader reader = new WKTReader();

//        LineString line = (LineString) reader.read(
//                "LINESTRING(20 20, 20 25, 25 25, " +
//                "25 15, 15 15, 15 30, 30 30, 30 10, " +
//                "10 10, 10 35, 35 35, 35 5)");
//        panel.addGeometry(line);
//
//        line = (LineString) reader.read("LINESTRING(-10 40, 5 50, 20 40, 35 50, 50 40)");
//        panel.addGeometry(line);

        final MultiPolygon poly = (MultiPolygon)reader.read(
                "MULTIPOLYGON(((7.07151740348681 51.2428212436246,7.07466456869275 51.2442588925877,7.07473466136961 51.247264004389,7.07663097260135 51.2523854489141,7.07899236494897 51.254254406571,7.08213008264458 51.2579749692056,7.08378643920918 51.2608863286725,7.08569519230219 51.2618649489043,7.08737175417288 51.2614134875672,7.08965985630411 51.2616412699839,7.09175393872121 51.2620576348048,7.09376953927821 51.2633464839773,7.09684565679663 51.2633176825574,7.09804681638178 51.2637423038008,7.09838482158775 51.2632606841076,7.09864969275718 51.2630128575164,7.09699036029382 51.262449724203,7.09697462367132 51.2624627258925,7.09681297979068 51.2624011394952,7.09692282070931 51.2622601371833,7.09702135101795 51.2621336796962,7.09670904182164 51.2620650114371,7.09646174058421 51.2619298498295,7.09660079518164 51.261684754017,7.09670926646805 51.2615310418379,7.09694879064564 51.2613102489598,7.0970458947362 51.2611645433865,7.09705665501713 51.2611170125516,7.09703708995446 51.2609762617795,7.09701526022848 51.2609002936628,7.09694005845453 51.2608228286921,7.09671113314454 51.260635525968,7.0966887121418 51.2606200658166,7.09668065694034 51.2605039822785,7.09669700824136 51.2604125601929,7.09678817416278 51.260127947475,7.0959667607336 51.2600284668531,7.09591651474385 51.2600223595094,7.09519004454699 51.2600291630884,7.09457256596463 51.2599743572077,7.09299024968782 51.2598305878885,7.09259906359325 51.2597680929299,7.0923774173857 51.2597147463462,7.09215560282562 51.259643405142,7.09187967894322 51.2596046949034,7.09153423387972 51.2597009178761,7.09133857220448 51.2598305475609,7.0911688740178 51.2598697041853,7.09036817737526 51.2600088575184,7.09025025019 51.2600140016557,7.0902093606862 51.259884403296,7.09004898841422 51.259851560208,7.08945738955574 51.2593218724812,7.08972967259654 51.2592226158015,7.09035797361215 51.2590332977437,7.09015614204743 51.2587860964704,7.09003005128889 51.2586701461302,7.09014784701787 51.2583146161669,7.09024547609954 51.2582207610883,7.09039732646755 51.2581359287563,7.09026991967099 51.2580611600913,7.09021922250857 51.2576866157086,7.09021863298134 51.257256232672,7.08996533987471 51.2572917620991,7.08985196647815 51.2573134928943,7.08982484018717 51.2572568458826,7.08983581980776 51.2570791229228,7.08990058328091 51.2569464725808,7.08990374227496 51.2568801949504,7.08991131283605 51.2568005726423,7.08993197710765 51.256644692342,7.08995601979511 51.2564620835177,7.08999994125439 51.25612674779,7.09013739519813 51.2555852338716,7.08885522218132 51.2551996865506,7.08890978510362 51.2551142335164,7.08855246834038 51.2550330634946,7.08886535902703 51.2545498742865,7.08903090498481 51.2542752502874,7.08957241543156 51.2533747328892,7.08990539136458 51.2528574654287,7.0900648862524 51.252606087611,7.09048001725184 51.2519595113988,7.09081462726296 51.2513608762995,7.09102225035869 51.2508922357443,7.09118787107304 51.2505069542525,7.09125170845451 51.2503357491856,7.0914075426022 51.2499063331886,7.09141624383693 51.2498806336016,7.0917448651601 51.2499732988048,7.09185507938146 51.2499580675928,7.0919682531174 51.2499770564043,7.09232769471539 51.2500042626385,7.0925562445185 51.2499657239223,7.09288713322836 51.250015217068,7.09345978164709 51.2501844299843,7.09356403634747 51.250087094208,7.09371898908366 51.2499593512226,7.09379727086767 51.2498962361771,7.09442107025774 51.2493907975124,7.09383082716037 51.2488603095687,7.09384686877311 51.2488241140071,7.0939385685133 51.2488134585238,7.09390127703574 51.2487147494319,7.09413074090175 51.2486127364157,7.09499804019077 51.2482293332737,7.09547950505098 51.2479977650586,7.09505259496427 51.2476261156507,7.09498997468016 51.2476730217707,7.09488127658634 51.2476222001934,7.0954515422082 51.2470385498206,7.09445694855234 51.246427355248,7.09517914715339 51.2459606324568,7.09532217546237 51.2458682354183,7.09569209710357 51.2461687760601,7.09581170017611 51.2462175441298,7.09635168108836 51.2466465590465,7.09646031109367 51.2466554286124,7.09673505311537 51.246705348155,7.09679592358213 51.2466933614686,7.09721158188059 51.2463998401375,7.0981827766476 51.2466887985155,7.09836337737727 51.2466826981973,7.09836397525857 51.2465996349501,7.09877940525764 51.2466032839102,7.09895085895485 51.2466640562974,7.09938888795812 51.2468284823597,7.0997331549839 51.2468388193582,7.09983081239784 51.2468319684593,7.10006488677235 51.2468400146464,7.10009368634239 51.2468525080587,7.10013737929546 51.246858928698,7.10031379077778 51.2468453140782,7.10038195244291 51.2468328074904,7.10069004539106 51.2467197944012,7.10085648436629 51.246612518337,7.10096425621015 51.2465674582629,7.10112339345373 51.2464962961222,7.10119923360158 51.2464515364251,7.1012341716751 51.2463972739543,7.10124860503178 51.2463360133858,7.10122974919479 51.2463021228901,7.10115274455938 51.2462382174848,7.10104315416704 51.2461472025519,7.10101451023474 51.2461112468163,7.10098346598385 51.2460347736204,7.10095110336888 51.245903120831,7.10092608621628 51.2458091523754,7.10112683335097 51.2456154390793,7.10102842278157 51.245404856071,7.1004977136841 51.244807592523,7.10085523364957 51.244671911217,7.10073040036786 51.2445481399736,7.10057817330935 51.2439609775347,7.10056318877614 51.2439032298406,7.10031522392676 51.2434028120547,7.09971197515898 51.2434491153149,7.09950737579114 51.2434812415761,7.09906220585874 51.243604528718,7.09876068918894 51.2437343750398,7.09866171624539 51.2437218213475,7.09849897843637 51.2439540955527,7.09777800627433 51.2437662541938,7.09789367626748 51.2434697924284,7.09801189218687 51.2432622071091,7.09836469505071 51.2433433905476,7.09834339567773 51.2430806644608,7.09830914382974 51.2430796377535,7.09815466938158 51.2429254898557,7.09815691541818 51.2428033991425,7.09810366119671 51.2427501453394,7.09785887909068 51.2423879421853,7.09750472638129 51.2424481657252,7.09718146816737 51.2425489081161,7.09690539555474 51.2425804418201,7.09671035382617 51.2421596114492,7.09653921872312 51.2418225131944,7.0962760358449 51.2414686591617,7.09613922833231 51.2412499822896,7.0959653210812 51.2409947083961,7.09586458305045 51.240853447442,7.09538821388982 51.240826268703,7.0952705031743 51.2408203596709,7.09519227145499 51.240824597908,7.09497916153222 51.240805559095,7.09473769763621 51.2407744704516,7.09457485862169 51.2407496569047,7.09442855280984 51.2407275648876,7.09411596690453 51.2407166464074,7.09412303053541 51.240447182172,7.09402846102574 51.2404448307676,7.09394744521682 51.2394992341567,7.09420262998038 51.2394390483101,7.09434367509764 51.2393905368367,7.09448179271687 51.2393333333246,7.0946500888229 51.2392565210103,7.09470596008244 51.2387330221297,7.0946951276553 51.2385120857067,7.09472749491203 51.2381867430062,7.09560392761876 51.2382622234438,7.09588899903457 51.2382910140131,7.09608890195402 51.2383007095635,7.09612647653928 51.2381369386395,7.09616800529868 51.2381394348818,7.09623840440564 51.237999941007,7.09665254289383 51.2375156630991,7.09547113171453 51.2374044849149,7.09534744867148 51.2374300931894,7.09519343833419 51.2374870870241,7.09509580944947 51.2375666543256,7.09505819084176 51.2376407157896,7.09502609950405 51.2377364787083,7.09471774480186 51.2377461069373,7.09467104155138 51.2376728348149,7.09455661123807 51.2375574990805,7.0943949541685 51.2374794597677,7.09418805672831 51.2374560467377,7.09415909117389 51.2374543401489,7.09394119940115 51.2374563783232,7.09353809711871 51.2374618557962,7.09352779337147 51.2372569145945,7.09352822589385 51.2372389326863,7.09351211966593 51.2370658395809,7.09322115415344 51.2370851891249,7.09255961063001 51.2371179779459,7.09214585487757 51.2370985609204,7.09184303433294 51.2370648032613,7.09149697236928 51.23699485443,7.09119677287172 51.2368479719098,7.09094440494551 51.2367073032773,7.09074921666913 51.2365195292099,7.09061221667979 51.2363278863338,7.09053341860623 51.2361323747238,7.08987205721738 51.236208698069,7.08962916932918 51.2361392204956,7.08935148366497 51.2360302096106,7.08921935287995 51.235991592272,7.08892631671726 51.2359491425504,7.0882385997313 51.2358625529517,7.08825159029673 51.2360537345023,7.0885952593515 51.2362684189785,7.08868264064944 51.2363845066811,7.08901124511279 51.236498357509,7.08911208242426 51.2366075509364,7.08907545888932 51.2367883357489,7.08887614847359 51.2369888468237,7.08873848639133 51.2369319699867,7.08848716761931 51.2372162019883,7.08838714960587 51.2373345281772,7.08774683669439 51.2378461121651,7.08778941797552 51.2380667538688,7.08753819571565 51.2379854031842,7.08748022282173 51.238235115279,7.08736696517345 51.2382234040021,7.08734651829422 51.2383400006925,7.08728803086637 51.2385679642548,7.08725593328648 51.2385609816055,7.08715929659357 51.2386650727633,7.08732310505546 51.2387253938456,7.08678911669749 51.2389558889796,7.0867720566461 51.2392161869899,7.0861990345318 51.2392126109225,7.08571173713432 51.2392007755188,7.08518308074585 51.2391656809595,7.08505813065452 51.2393324215682,7.08502080932559 51.2393840882564,7.08550483731422 51.2395520917933,7.08566492719617 51.239620773446,7.08568290753595 51.2396326337264,7.08555928685272 51.2398014389603,7.08552753563046 51.2398219533334,7.08551417799658 51.2398328406422,7.08544807905221 51.2398130015873,7.08523010636651 51.2397423964518,7.08490086252433 51.2396281292597,7.08463389047235 51.2395318646899,7.08428577289253 51.2394237358454,7.08378997911971 51.2392374350827,7.08315299589691 51.2389788655084,7.08264089466156 51.2387728939343,7.08076968097131 51.2383977317739,7.07897138393899 51.2417698265142,7.0741643208315 51.2416742588227,7.07068279753715 51.2425182478293,7.07151740348681 51.2428212436246)))");

        panel.addGeometry(poly);

        frame.setVisible(true);
    }
}
